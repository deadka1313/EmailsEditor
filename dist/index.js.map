{"version":3,"file":"index.js","sources":["../src/constants.ts","../src/index.ts"],"sourcesContent":["export const checkregularEmail = /^((\"[\\w-\\s]+\")|([\\w-]+(?:\\.[\\w-]+)*)|(\"[\\w-\\s]+\")([\\w-]+(?:\\.[\\w-]+)*))(@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,6}(?:\\.[a-z]{2})?)$)|(@\\[?((25[0-5]\\.|2[0-4][0-9]\\.|1[0-9]{2}\\.|[0-9]{1,2}\\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\\]?$)/i;\n","import './index.sass';\r\nimport { ICreateEmailForm } from './ICreateEmailForm';\r\nimport { IEmailsIsValid } from './IEmailsIsValid';\r\nimport { checkregularEmail } from './constants';\r\n\r\nexport default class CreateEmailForm implements ICreateEmailForm {\r\n    private readonly element: HTMLElement;\r\n    private readonly placeholderElement: HTMLElement | null = null;\r\n\r\n    private isPaste = false;\r\n    private isEdit = false;\r\n\r\n    private emails: IEmailsIsValid[] = [];\r\n\r\n    private updateDom = (): void => {\r\n        const wrapperElement = this.element.querySelector('.email-editor_wrapper-emails');\r\n        if (wrapperElement) {\r\n            wrapperElement.innerHTML = this.generateEmailsDom();\r\n            const emailElements = this.element.querySelectorAll('.emails-editor_closebtn');\r\n            for (let i = 0; i < emailElements.length; i++) {\r\n                const emailElement = emailElements[i];\r\n                emailElement.addEventListener('click', e => this.removeEmail(e));\r\n            }\r\n        }\r\n    };\r\n\r\n    private generateEmailsDom = (): string => {\r\n        let emailDom = '';\r\n        this.emails.map(item => {\r\n            emailDom +=\r\n                `<span class=\"emails-editor_email emails-editor_email__${item.isValid ? 'valid' : 'invalid'}\">` +\r\n                item.name +\r\n                '<span class=\"emails-editor_closebtn\">&times;</span>' +\r\n                '</span>';\r\n        });\r\n        const divForm = this.element.querySelector('.emails-editor_form');\r\n        if (divForm) {\r\n            divForm.scrollTop = divForm.scrollHeight;\r\n        }\r\n        return emailDom;\r\n    };\r\n\r\n    private setFocusInput = (e: Event | null): void => {\r\n        const div = this.element.querySelector('span.emails-editor_input');\r\n        if (\r\n            e &&\r\n            (e.target as HTMLTextAreaElement).className.indexOf('emails-editor_input') === -1 &&\r\n            (e.target as HTMLTextAreaElement).className.indexOf('emails-editor_closebtn') === -1 &&\r\n            (e.target as HTMLTextAreaElement).className.indexOf('emails-editor_email') === -1 &&\r\n            !this.isEdit &&\r\n            div instanceof HTMLElement\r\n        ) {\r\n            this.isEdit = true;\r\n            div.focus();\r\n            const range = document.createRange();\r\n            range.selectNodeContents(div);\r\n            range.collapse(false);\r\n            const sel = window.getSelection();\r\n            if (sel) {\r\n                sel.removeAllRanges();\r\n                sel.addRange(range);\r\n            }\r\n        }\r\n    };\r\n\r\n    private onFocusInput = (): void => {\r\n        if (this.placeholderElement) {\r\n            this.placeholderElement.style.display = 'none';\r\n            this.isEdit = false;\r\n        }\r\n    };\r\n\r\n    private onChangeInput = (e: Event | null): void => {\r\n        if (e) {\r\n            const value = (e.target as HTMLTextAreaElement).innerText;\r\n            if (value.length === 1 && this.checkEnterWord(value)) {\r\n                const divInput = this.element.querySelector('.emails-editor_input');\r\n                if (divInput) {\r\n                    divInput.innerHTML = '';\r\n                }\r\n            }\r\n            if ((value && value.length > 1 && this.checkEnterWord(value)) || this.isPaste) {\r\n                this.isPaste = false;\r\n                this.addEmail(value);\r\n            }\r\n        }\r\n    };\r\n\r\n    private onBlurInput = (e: Event | null): void => {\r\n        if (this.placeholderElement) {\r\n            this.placeholderElement.style.display = 'inline-block';\r\n        }\r\n        if (e) {\r\n            const email = (e.target as HTMLTextAreaElement).innerText.replace(/(^\\s*)|(\\s*)$/g, '');\r\n            if (email) {\r\n                this.addEmail(email);\r\n            }\r\n        }\r\n    };\r\n\r\n    private checkEnterWord = (value: string): boolean => {\r\n        return /[\\s,]/g.test(value);\r\n    };\r\n\r\n    private addEmail = (email: string): void => {\r\n        let inputEmails: string = email.replace(/(^\\s*)|(\\s*)$/g, '');\r\n        inputEmails = inputEmails.replace(/(,\\s*)$/g, ',');\r\n        const inputEmailsSplit: string[] = inputEmails.split(/\\s|,/).filter(item => item);\r\n        const newEmails: IEmailsIsValid[] = inputEmailsSplit.map(item => {\r\n            return {\r\n                name: item,\r\n                isValid: this.checkValid(item),\r\n            };\r\n        });\r\n        newEmails.map(item => {\r\n            if (!this.checkForMatch(item.name)) {\r\n                this.emails.push(item);\r\n            }\r\n        });\r\n\r\n        const divInput = this.element.querySelector('.emails-editor_input');\r\n        if (divInput) {\r\n            divInput.innerHTML = '';\r\n        }\r\n\r\n        this.updateDom();\r\n    };\r\n\r\n    private checkValid = (email: string) => {\r\n        const pattern = new RegExp(checkregularEmail);\r\n        return pattern.test(email);\r\n    };\r\n\r\n    private removeEmail = (e: Event | null): void => {\r\n        if (e) {\r\n            const email = ((e.target as HTMLTextAreaElement).parentElement as HTMLElement).innerHTML.split('<')[0];\r\n            this.emails = this.emails.filter(item => item.name !== email);\r\n            this.updateDom();\r\n        }\r\n    };\r\n\r\n    private checkForMatch = (email: string): boolean => {\r\n        for (let i = 0; i < this.emails.length; i++) {\r\n            if (this.emails[i].name === email) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    private checkValidEmailsStore = (): IEmailsIsValid[] => {\r\n        return this.emails.filter(item => item.isValid);\r\n    };\r\n\r\n    constructor(element: HTMLElement) {\r\n        this.element = element;\r\n        this.element.innerHTML =\r\n            '<div class=\"emails-editor_form\">' +\r\n            '<span class=\"email-editor_wrapper-emails\">' +\r\n            this.generateEmailsDom() +\r\n            '</span>' +\r\n            '<span class=\"emails-editor_input\" contenteditable=\"true\">' +\r\n            '</span>' +\r\n            '<span class=\"emails-editor_placeholder\">add more peopleâ€¦</span>' +\r\n            '</div>';\r\n\r\n        this.placeholderElement = this.element.querySelector('.emails-editor_placeholder');\r\n\r\n        const divForm = this.element.querySelector('.emails-editor_form');\r\n        if (divForm) {\r\n            divForm.addEventListener('click', e => this.setFocusInput(e));\r\n        }\r\n\r\n        const divInput = this.element.querySelector('.emails-editor_input');\r\n        if (divInput) {\r\n            divInput.addEventListener('input', e => this.onChangeInput(e));\r\n            divInput.addEventListener('focus', () => this.onFocusInput());\r\n            divInput.addEventListener('blur', e => this.onBlurInput(e));\r\n            divInput.addEventListener('keydown', e => {\r\n                if (\r\n                    ((e as KeyboardEvent).ctrlKey || (e as KeyboardEvent).metaKey) &&\r\n                    (e as KeyboardEvent).key === 'v'\r\n                ) {\r\n                    this.isPaste = true;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    public setEmail(email: string): void {\r\n        this.addEmail(email);\r\n    }\r\n\r\n    public getEmail(): string[] {\r\n        return this.checkValidEmailsStore().map(item => {\r\n            return item.name;\r\n        });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}